<div class="register-wrapper">
  <div class="register-container">
    <div class="register-card">

        <!-- Step Indicator -->
      <div class="step-indicator">
        <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">
          <div class="step-number">1</div>
          <div class="step-label">Account</div>
        </div>
        <div class="step-line" [class.completed]="currentStep > 1"></div>
        <div class="step" [class.active]="currentStep >= 2">
          <div class="step-number">2</div>
          <div class="step-label">Verify</div>
        </div>
      </div>

    @if (currentStep === 1) {
    <div class="form-step">
    <h2 class="title">Welcome To YMC</h2>
    <p class="subtitle">Sign up to get started</p>
  
  <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">

    <!-- Username -->
    <div class="form-group">
        <label for="username" class="form-label">Username
        </label>
        <input type="text" id="username" type="username"
            class="form-control" formControlName="username" placeholder="Create Username"
             [class.is-invalid]="registerForm.get('username')?.invalid && registerForm.get('username')?.touched" />
        @if(registerForm.get('username')?.invalid && registerForm.get('username')?.touched)
        {
            <div class="error-message">
                  <i class="bi bi-exclamation-circle"></i>
                  @if (registerForm.get('username')?.errors?.['required']) {
                    <span>Username is required</span>
                  }
                  @if (registerForm.get('username')?.errors?.['minlength']) {
                    <span>Username must be at least 3 characters</span>
                  }
                  @if (registerForm.get('username')?.errors?.['pattern']) {
                    <span>Only letters, numbers, and underscores allowed</span>
                  }
                </div>
        }
    </div>

    <!-- Email -->
    <div class="form-group">
      <label for="email" class="form-label">Email</label>
       <input type="text"  id="email" type="email"
            class="form-control"  formControlName="email" placeholder="Enter your email" 
             [class.is-invalid]="registerForm.get('email')?.invalid && registerForm.get('email')?.touched" />
      @if (registerForm.get('email')?.invalid && registerForm.get('email')?.touched) 
      {
         <div class="error-message">
                  <i class="bi bi-exclamation-circle"></i>
                  @if (registerForm.get('email')?.errors?.['required']) {
                    <span>Email is required</span>
                  }
                  @if (registerForm.get('email')?.errors?.['email']) {
                    <span>Invalid email address</span>
                  }
                </div>
      }
    </div>

 

 <!-- New Password -->
    <div class="form-group">
      <label for="password" class="form-label">Password</label>
      <div class="password-wrapper">
       <input 
        [type]="showPassword ? 'text' : 'password'"  
        id="password"  
        class="form-control"  
        formControlName="password" 
        placeholder="Enter password"
        [class.is-invalid]="registerForm.get('password')?.invalid && registerForm.get('password')?.touched" />
        <button 
            type="button"
            class="password-toggle" 
            (click)="showPassword = !showPassword"
            >
            <i [class]="showPassword ? 'bi bi-eye-slash' : 'bi bi-eye'">
            </i>
        </button>
        </div>

      @if (registerForm.get('password')?.invalid && registerForm.get('password')?.touched) {
            <div class="error-message">
                  <i class="bi bi-exclamation-circle"></i>
                  @if (registerForm.get('password')?.errors?.['required']) {
                    <span>Password is required</span>
                  }
                  <!-- @if (registerForm.get('password')?.errors?.['minlength']) {
                    <span>Password must be at least 8 characters</span>
                  } -->
                  <!-- @if (registerForm.get('password')?.errors?.['pattern']) {
                    <span>Include uppercase, lowercase, number, and special character</span>
                  } -->
                </div>
      }
    


    <!-- Password Strength -->
              <div class="password-strength">
                <div class="strength-bar">
                  <div 
                    class="strength-fill" 
                    [style.width.%]="passwordStrength"
                    [class.weak]="passwordStrength < 40"
                    [class.medium]="passwordStrength >= 40 && passwordStrength < 70"
                    [class.strong]="passwordStrength >= 70"
                  ></div>
                </div>
                <small class="strength-text">{{ getPasswordStrengthText() }}</small>
              </div>
    </div>


 <!-- ConFirm Password -->
    <div class="form-group">
      <label for="confirm-password" class="form-label">Confirm Password</label>
       <div class="password-wrapper">
       <input 
        [type]="showConfirmPassword ? 'text' : 'password'" 
        id="confirmPassword"  class="form-control" 
        formControlName="confirmPassword"
        placeholder="Confirm your Password"
        [class.is-invalid]="registerForm.get('confirmPassword')?.invalid && registerForm.get('confirmPassword')?.touched"
        />
         <button 
            type="button" 
            class="password-toggle" 
            (click)="showConfirmPassword = !showConfirmPassword"
        >
            <i [class]="showConfirmPassword ? 'bi bi-eye-slash' : 'bi bi-eye'"></i>
        </button>
    </div>

      @if (registerForm.errors?.['passwordMismatch'] && registerForm.get('confirmPassword')?.touched) {
        <div class="error-message">
            <i class="bi bi-exclamation-circle"></i>
            <span>Passwords do not match</span>
        </div>
      }
    </div>


     <!-- Error Message -->
        @if (errorMessage) {
          <div class="alert alert-danger" role="alert">
            <i class="bi bi-x-circle"></i>
            {{ errorMessage }}
          </div>
        }

    <!--test Debug-->
              <!-- <div style="background: #f5f5f5; padding: 10px; margin-bottom: 10px; border-radius: 4px; font-size: 12px;">
                <p><strong>Debug Info:</strong></p>
                <p>Form Valid: {{ registerForm.valid }}</p>
                <p>Form Invalid: {{ registerForm.invalid }}</p>
                <p>Is Loading: {{ isLoading }}</p>
                <p>Username: {{ registerForm.get('username')?.value }} (Valid: {{ registerForm.get('username')?.valid }})</p>
                <p>Email: {{ registerForm.get('email')?.value }} (Valid: {{ registerForm.get('email')?.valid }})</p>
                <p>Password: {{ registerForm.get('password')?.value }} (Valid: {{ registerForm.get('password')?.valid }})</p>
                <p>Confirm: {{ registerForm.get('confirmPassword')?.value }} (Valid: {{ registerForm.get('confirmPassword')?.valid }})</p>
                <p>Passwords Match: {{ registerForm.errors?.['passwordMismatch'] === null }}</p>
              </div> -->




    <!-- Submit Button -->
        <button type="submit" 
            class="btn btn-primary btn-register" 
            [disabled]="registerForm.invalid || isLoading"
        >
        @if (isLoading)
        {
            <span class="spinner-border spinner-border-sm me-2"></span>
            Sending OTP to your Email...
            } @else {
            Continue
        }
        </button>

         <!-- Login Link -->
            <div class="text-center mt-3">
              <span class="text-muted">Already have an account?</span>
              <a routerLink="/login" class="login-link">Sign In</a>
            </div>
          </form>
        </div>
    }

        <!-- Step 2: OTP Verification -->
        @if(currentStep == 2)
        {
            <div class="form-step">
                <div class="otp-icon">
                    <i class="bi bi-envelope-check"></i>
                </div>
                <h2 class="title">Verify Your Email</h2>
                <p class="subtitle">
                    We sent a 6-digit code to<br>
                    <strong>{{ registerForm.get('email')?.value }}</strong>
                </p>

                <form (ngSubmit)="onVerifyOTP()">
                <!-- OTP Space -->
                 <div class="form-group">
                    <label class="form-lable">Enter Verification Code</label>
                    <div class="otp-inputs">
                        @for( digit of [0,1,2,3,4,5]; track digit )
                        {
                            <input 
                                type="text"
                                maxlength="1"
                                class="otp-input"
                                [id]="'otp-'+digit"
                                [(ngModel)] ="otpDigits[digit]"
                                [ngModelOptions]="{standalone: true}"
                                (input)="onOtpInput($event, digit)"
                                (keydown)="onOtpKeydown($event, digit)"
                                (paste)="onOtpPaste($event)"
                                />
                        }
                    </div>
                 </div>
                 <!-- Error Message -->
            @if (otpErrorMessage) {
              <div class="alert alert-danger">
                <i class="bi bi-x-circle"></i>
                {{ otpErrorMessage }}
              </div>
            }

            <!-- Success Message -->
            @if (otpSuccessMessage) {
              <div class="alert alert-success">
                <i class="bi bi-check-circle"></i>
                {{ otpSuccessMessage }}
              </div>
            }

             <!-- Resend -->
            <div class="text-center mb-3">
              @if (resendCountdown > 0) {
                <span class="text-muted">Resend code in {{ resendCountdown }}s</span>
              } @else {
                <span class="text-muted">Didn't receive the code?</span>
                <a (click)="onResendOTP()" class="resend-link">Resend</a>
              }
            </div>

           
            <!-- Submit Button -->
            <button 
              type="submit" 
              class="btn btn-primary btn-submit" 
              [disabled]="!isOtpComplete() || isVerifying"
            >
              @if (isVerifying) {
                <span class="spinner-border spinner-border-sm me-2"></span>
                Verifying...
              } @else {
                Verify & Register
              }
            </button>

             <!-- Back Button -->
            <button 
              type="button" 
              class="btn btn-outline-secondary btn-back mt-2" 
              (click)="goBackToForm()"
            >
              <i class="bi bi-arrow-left"></i> Back
            </button>


           </form>
        </div>
      }
    </div>
  </div>
</div>
